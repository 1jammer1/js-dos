<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>js-dos 6.22, Dhrystone Benchmark</title>
  <script src="/js-dos.js"></script>
  <style>
    html, body, canvas, .dosbox-container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <canvas id="jsdos"></canvas>
  <script>
    Dos(document.getElementById("jsdos"), {
      wdosboxUrl: "/wdosbox.js",
      cycles: "max",
      autolock: "false",
    }).ready(function (fs, main) {
      fs.extract("https://js-dos.com/6.22/current/test/dhry2.zip").then(function () {
        main(["-c", "DHRY2OD.EXE"]).then(function (ci) {
          const oneRunMSecs = /Microseconds for one run through Dhrystone:\s+([0-9.]+)/;
          const dhrystonesPerSec = /Dhrystones per Second:\s+([0-9.]+)/;
          const vaxMips = /VAX  MIPS rating =\s+([0-9.]+)/;
          const result = {};
          ci.listenStdout(function (message) {
            const oneRunMSecsMatch = oneRunMSecs.exec(message);
            const dhrystonesPerSecMatch = dhrystonesPerSec.exec(message);
            const vaxMipsMatch = vaxMips.exec(message);

            if (oneRunMSecsMatch) {
              result['oneRunMSecs'] = Number.parseFloat(oneRunMSecsMatch[1]);
            } else if (dhrystonesPerSecMatch) {
              result['dhrystonesPerSec'] = Number.parseFloat(dhrystonesPerSecMatch[1]);
            } else if (vaxMipsMatch) {
              result['vaxMips'] = Number.parseFloat(vaxMipsMatch[1]);
              console.log(result);
              setTimeout(function () {
                ci.exit();
              }, 1000)
            }
          });
        });
      });
    });
  </script>
</body>

</html>