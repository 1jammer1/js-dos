<!DOCTYPE html>

<html>
<head>
  <title>JsDosUi</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="../js-dos-cpp/include/js-dos-3rdparty.html">
                js-dos-3rdparty.h
              </a>
            
              
              <a class="source" href="../js-dos-cpp/include/js-dos-ci.html">
                js-dos-ci.h
              </a>
            
              
              <a class="source" href="../js-dos-cpp/include/js-dos-events.html">
                js-dos-events.h
              </a>
            
              
              <a class="source" href="../js-dos-cpp/include/js-dos-json.html">
                js-dos-json.h
              </a>
            
              
              <a class="source" href="../js-dos-cpp/js-dos-3rdparty.html">
                js-dos-3rdparty.c
              </a>
            
              
              <a class="source" href="../js-dos-cpp/js-dos-ci.html">
                js-dos-ci.cpp
              </a>
            
              
              <a class="source" href="../js-dos-cpp/js-dos-events.html">
                js-dos-events.cpp
              </a>
            
              
              <a class="source" href="../js-dos-cpp/js-dos-json.html">
                js-dos-json.cpp
              </a>
            
              
              <a class="source" href="js-dos-build.html">
                js-dos-build.ts
              </a>
            
              
              <a class="source" href="js-dos-ci.html">
                js-dos-ci.ts
              </a>
            
              
              <a class="source" href="js-dos-fs.html">
                js-dos-fs.ts
              </a>
            
              
              <a class="source" href="js-dos-host.html">
                js-dos-host.ts
              </a>
            
              
              <a class="source" href="js-dos-module.html">
                js-dos-module.ts
              </a>
            
              
              <a class="source" href="js-dos-options.html">
                js-dos-options.ts
              </a>
            
              
              <a class="source" href="js-dos-ui.html">
                js-dos-ui.ts
              </a>
            
              
              <a class="source" href="js-dos-xhr.html">
                js-dos-xhr.ts
              </a>
            
              
              <a class="source" href="js-dos.html">
                js-dos.ts
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { DosModule } <span class="hljs-keyword">from</span> <span class="hljs-string">"./js-dos-module"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="jsdosui">JsDosUi</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Optional ui module to show progress if onprogress is not set by client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> DosUi {
    <span class="hljs-keyword">private</span> canvas: HTMLCanvasElement;
    <span class="hljs-keyword">private</span> dos: DosModule;

    <span class="hljs-keyword">private</span> overlay: HTMLDivElement;
    <span class="hljs-keyword">private</span> loaderMessage: HTMLDivElement;
    <span class="hljs-keyword">private</span> hidden: <span class="hljs-built_in">boolean</span>;

    <span class="hljs-keyword">constructor</span>(<span class="hljs-params">dos: DosModule</span>) {
        <span class="hljs-keyword">this</span>.dos = dos;
        <span class="hljs-keyword">this</span>.canvas = dos.canvas;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"js-dos-ui-css"</span>) === <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">const</span> style = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"style"</span>) <span class="hljs-keyword">as</span> HTMLStyleElement;
                style.id = <span class="hljs-string">"js-dos-ui-css"</span>;
                style.innerHTML = <span class="hljs-keyword">this</span>.css;
                <span class="hljs-built_in">document</span>.head.appendChild(style);
            }

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.canvas.parentElement.className !== <span class="hljs-string">"dosbox-container"</span>) {
                <span class="hljs-keyword">const</span> container = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>) <span class="hljs-keyword">as</span> HTMLDivElement;
                container.className = <span class="hljs-string">"dosbox-container"</span>;

                <span class="hljs-keyword">const</span> parent = <span class="hljs-keyword">this</span>.canvas.parentElement;
                parent.replaceChild(container, <span class="hljs-keyword">this</span>.canvas);
                container.appendChild(<span class="hljs-keyword">this</span>.canvas);

                <span class="hljs-keyword">const</span> overlay = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>) <span class="hljs-keyword">as</span> HTMLDivElement;
                overlay.className = <span class="hljs-string">"dosbox-overlay"</span>;
                container.appendChild(overlay);

                overlay.innerHTML = <span class="hljs-keyword">this</span>.overlayHtml;
            }

            <span class="hljs-keyword">const</span> container = <span class="hljs-keyword">this</span>.canvas.parentElement;
            <span class="hljs-keyword">this</span>.overlay = <span class="hljs-keyword">this</span>.childById(container, <span class="hljs-string">"dosbox-overlay"</span>);
            <span class="hljs-keyword">this</span>.loaderMessage = <span class="hljs-keyword">this</span>.childById(<span class="hljs-keyword">this</span>.overlay, <span class="hljs-string">"dosbox-loader-message"</span>);

            <span class="hljs-keyword">this</span>.hidden = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">this</span>.hide();
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">this</span>.onprogress = <span class="hljs-keyword">this</span>.onprogressFallback;
        }
    }

    <span class="hljs-keyword">public</span> onprogress(stage: <span class="hljs-built_in">string</span>, total: <span class="hljs-built_in">number</span>, loaded: <span class="hljs-built_in">number</span>) {
        <span class="hljs-keyword">const</span> message = stage + <span class="hljs-string">" "</span> + <span class="hljs-built_in">Math</span>.round(loaded * <span class="hljs-number">100</span> / total * <span class="hljs-number">10</span>) / <span class="hljs-number">10</span> + <span class="hljs-string">"%"</span>;
        <span class="hljs-keyword">this</span>.loaderMessage.innerHTML = message;
        <span class="hljs-keyword">this</span>.dos.info(message);

        <span class="hljs-keyword">if</span> (loaded &gt;= total) {
            <span class="hljs-keyword">this</span>.hide();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.show();
        }
    }

    <span class="hljs-keyword">public</span> detach() {
        <span class="hljs-keyword">this</span>.hide();
        <span class="hljs-keyword">this</span>.onprogress = <span class="hljs-keyword">this</span>.onprogressFallback;
    }

    <span class="hljs-keyword">public</span> hide() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hidden) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.hidden = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.overlay.setAttribute(<span class="hljs-string">"style"</span>, <span class="hljs-string">"display: none"</span>);
    }

    <span class="hljs-keyword">public</span> show() {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hidden) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.hidden = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.overlay.setAttribute(<span class="hljs-string">"style"</span>, <span class="hljs-string">"display: block"</span>);
    }

    <span class="hljs-keyword">private</span> onprogressFallback(stage: <span class="hljs-built_in">string</span>, total: <span class="hljs-built_in">number</span>, loaded: <span class="hljs-built_in">number</span>) {
        <span class="hljs-keyword">this</span>.dos.info(stage + <span class="hljs-string">" "</span> + loaded * <span class="hljs-number">100</span> / total + <span class="hljs-string">"%"</span>);
    }

    <span class="hljs-keyword">private</span> childById(parent: Element, className: <span class="hljs-built_in">string</span>) {
        <span class="hljs-keyword">if</span> (parent === <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; parent.childElementCount; ++i) {
            <span class="hljs-keyword">let</span> child = parent.children[i];
            <span class="hljs-keyword">if</span> (child.className === className) {
                <span class="hljs-keyword">return</span> child <span class="hljs-keyword">as</span> HTMLDivElement;
            }

            child = <span class="hljs-keyword">this</span>.childById(child, className);
            <span class="hljs-keyword">if</span> (child !== <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> child <span class="hljs-keyword">as</span> HTMLDivElement;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/* tslint:disable:member-ordering */</span>
    <span class="hljs-comment">/* tslint:disable:max-line-length */</span>
    <span class="hljs-keyword">private</span> css: <span class="hljs-built_in">string</span> = <span class="hljs-string">`
    .dosbox-container { position: relative; min-width: 320px; min-height: 200px; display: inline-block; }
    .dosbox-overlay, .dosbox-loader { position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(51, 51, 51, 0.7); }
    .dosbox-start { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; color: #f80; font-size: 1.5em; text-decoration: underline; cursor: pointer; }
    .dosbox-overlay a { color: #f80; }
    .dosbox-powered { position: absolute; right: 1em; bottom: 1em; font-size: 0.8em; color: #9C9C9C; }
    .dosbox-loader-message { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; margin: 0 0 -3em 0; box-sizing: border-box; color: #f80; font-size: 1.5em; }
    @-moz-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @-webkit-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } .st-loader { width: 10em; height: 2.5em; position: absolute; top: 50%; left: 50%; margin: -1.25em 0 0 -5em; box-sizing: border-box; }
    .st-loader:before, .st-loader:after { content: ""; display: block; position: absolute; top: 0; bottom: 0; width: 1.25em; box-sizing: border-box; border: 0.25em solid #f80; }
    .st-loader:before { left: -0.76923em; border-right: 0; }
    .st-loader:after { right: -0.76923em; border-left: 0; }
    .st-loader .equal { display: block; position: absolute; top: 50%; margin-top: -0.5em; left: 4.16667em; height: 1em; width: 1.66667em; border: 0.25em solid #f80; box-sizing: border-box; border-width: 0.25em 0; -moz-animation: loading 1.5s infinite ease-in-out; -webkit-animation: loading 1.5s infinite ease-in-out; animation: loading 1.5s infinite ease-in-out; background: #f80; }
    `</span>;

    <span class="hljs-comment">/* tslint:disable:member-ordering */</span>
    <span class="hljs-comment">/* tslint:disable:max-line-length */</span>
    <span class="hljs-keyword">private</span> overlayHtml: <span class="hljs-built_in">string</span> = <span class="hljs-string">`
        &lt;div class="dosbox-loader"&gt;
            &lt;div class="st-loader"&gt;
                &lt;span class="equal"&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class="dosbox-loader-message"&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="dosbox-powered"&gt;
            Powered by &amp;nbsp;&lt;a href="https://js-dos.com"&gt;js-dos.com&lt;/a&gt; (6.22)
        &lt;/div&gt;
    `</span>;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
